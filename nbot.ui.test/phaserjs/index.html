<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.19.0/dist/phaser.js"></script>
    <script type="text/javascript" src="nbotdata.js"></script>
</head>

<body>

    <script>

        var config = {
            type: Phaser.WEBGL,
            width: 800,
            height: 600,
            backgroundColor: '#2d2d2d',
            parent: 'phaser-example',
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        var arrow;
        var tween;
        var points;
        var points2;
        var points3;
        var points4;
        var points5;
        var t = 0;
        var _this;
        var graphics;
        var parts = 8;

        var game = new Phaser.Game(config);

        function preload() {
            this.load.image('arrow', 'assets/sprites/lemming.png');
        }

        function create() {

            graphics = this.add.graphics();

            // points = [
            //     50, 300, 179, 449, 394, 498, 593, 455,
            //     701, 338, 692, 190, 603, 76, 423, 41,
            //     272, 78, 181, 186, 230, 328, 416, 395,
            //     565, 327, 550, 202, 467, 149, 355, 164,
            //     343, 254, 428, 303
            // ];

            points = [
                50, 300, 179, 449, 394, 498, 593, 455
            ];
            points2 = [
                701, 338, 692, 190, 603, 76, 423, 41
            ];
            points3 = [
                272, 78, 181, 186, 230, 328, 416, 395
            ];
            points4 = [
                565, 327, 550, 202, 467, 149, 355, 164
            ];
            points5 = [
                343, 254, 428, 303
            ];

            _this = this;

            curve = new Phaser.Curves.Spline(points);
            path = { t: 0, vec: new Phaser.Math.Vector2() };
            arrow = this.add.image(400, 300, 'arrow');

            tween = this.tweens.add({
                targets: path,
                t: 1,
                x: 50,
                y: 300,
                ease: 'Sine.easeIn',
                duration: 2000,
                paused: true
            });

            t = 1;
            parts += 8;
            _this.time.addEvent({ delay: 500, callback: nextPoint, callbackScope: t, args: [t] });

            tween.play();

            // this.input.on('pointerdown', function () {

            //     tween.play();
            //     t = 1;
            //     parts += 8;
            //     _this.time.addEvent({ delay: 200, callback: nextPoint, callbackScope: t, args: [t] });
            // });
        }

        function nextPoint(t) {
            t += 1;
            tween.duration += 2000;

            if (t == 2) {
                curve.addPoints(points2);
            }
            if (t == 3) {
                curve.addPoints(points3);
            }
            if (t == 4) {
                curve.addPoints(points4);
            }
            if (t == 5) {
                curve.addPoints(points5);
            }

            tween.timeScale = 1 / t;

            if (t < 6) {
                _this.time.addEvent({ delay: 200, callback: nextPoint, callbackScope: t, args: [t] });
            }
        }

        function update() {
            graphics.clear();

            graphics.lineStyle(2, 0xffffff, 1);

            curve.draw(graphics, parts);

            curve.getPoint(path.t, path.vec);

            arrow.setPosition(path.vec.x, path.vec.y);
        }

    </script>

</body>

</html>